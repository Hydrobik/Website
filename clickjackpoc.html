<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Advanced Clickjacking Tester &amp; PoC Generator</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body {
    background: #191f2d;
    color: #e0e0e0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0;
  }
  .container {
    max-width: 680px;
    margin: 40px auto;
    padding: 28px 32px;
    background: #222c3e;
    border-radius: 14px;
    box-shadow: 0 0 40px rgba(0,0,0,0.7);
  }
  h1 {
    margin-bottom: 18px;
    font-weight: 700;
    font-size: 1.9em;
    color: #42b0f5;
    user-select: none;
  }
  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
  }
  input[type="url"] {
    width: 100%;
    padding: 12px 14px;
    font-size: 1.1em;
    border-radius: 8px;
    border: none;
    background: #1f2a41;
    color: #d1d9e6;
    box-sizing: border-box;
    margin-bottom: 18px;
  }
  input[type="url"]:focus {
    outline: 3px solid #47c7ff;
  }
  button {
    background-color: #369bfb;
    border: none;
    border-radius: 8px;
    padding: 12px 22px;
    font-weight: 600;
    color: #fff;
    font-size: 1.05em;
    cursor: pointer;
    margin-right: 12px;
    transition: background-color 0.2s ease;
  }
  button:disabled {
    background-color: #40607f;
    cursor: not-allowed;
  }
  button:hover:not(:disabled) {
    background-color: #2680eb;
  }
  .row {
    margin: 14px 0 26px 0;
    display: flex;
    flex-wrap: wrap;
    gap: 14px;
    align-items: center;
  }
  .status {
    font-size: 1.15em;
    padding: 12px 16px;
    border-radius: 12px;
    margin-bottom: 26px;
    user-select: none;
  }
  .status.ok {
    background-color: #2a4d1e;
    color: #ace69b;
    border: 2px solid #56b84b;
  }
  .status.bad {
    background-color: #5b1c1c;
    color: #ffa5a5;
    border: 2px solid #f03030;
  }
  .iframe-container {
    position: relative;
    width: 100%;
    height: 360px;
    border: 4px solid #264265;
    border-radius: 16px;
    overflow: hidden;
    background: #13203c;
  }
  iframe {
    width: 100%;
    height: 100%;
    border: none;
    border-radius: 16px;
    transition: opacity 0.3s ease;
    background: #fff;
  }
  iframe.ghost {
    opacity: 0.025 !important;
  }
  .overlay {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    pointer-events: none;
    user-select: none;
    z-index: 12;
  }
  .lure {
    position: absolute;
    top: 20%;
    left: 18%;
    padding: 14px 24px;
    background: #54a6ffcc;
    color: #07274b;
    font-weight: 700;
    border-radius: 14px;
    cursor: grab;
    user-select: none;
    box-shadow: 0 0 18px #4e94ffaa;
    pointer-events: auto;
    z-index: 17;
    transition: box-shadow 0.25s ease;
  }
  .lure:active {
    cursor: grabbing;
    box-shadow: 0 0 28px #4e94ffdd;
  }
  textarea {
    width: 100%;
    height: 160px;
    padding: 12px 16px;
    font-family: 'Courier New', monospace;
    font-size: 0.96em;
    border-radius: 12px;
    background-color: #1a2c56;
    color: #99c9ff;
    border: 2px solid #4787fc;
    margin-top: 14px;
    user-select: all;
    resize: vertical;
  }
  .panel {
    background-color: #192945;
    border-radius: 16px;
    padding: 22px 28px;
    margin-bottom: 24px;
    line-height: 1.45;
  }
  .desc-head {
    font-weight: 700;
    font-size: 1.3em;
    color: #4fc3ff;
    margin-bottom: 14px;
    user-select: none;
  }
  .result-description {
    color: #8bd1ff;
    font-size: 1.1em;
    margin-bottom: 14px;
  }
  .result-impact {
    color: #f6bb42;
    font-weight: 700;
    font-size: 1.05em;
    margin-bottom: 10px;
  }
  .result-remediation {
    color: #8fce7f;
    font-weight: 700;
    font-size: 1.05em;
  }
  @media (max-width: 720px) {
    .row {
      flex-direction: column;
      gap: 18px;
    }
    button {
      margin-right: 0;
      width: 100%;
    }
  }
</style>
</head>
<body>
  <div class="container" role="main" aria-label="Advanced Clickjacking Tester and PoC Generator">
    <h1>Advanced Clickjacking Tester &amp; PoC Generator</h1>
    <form id="testForm" onsubmit="return false">
      <label for="targetUrl">Target Website URL</label>
      <input id="targetUrl" type="url" placeholder="https://example.com/sensitive-action" required autocomplete="off" />
      <div class="row">
        <button id="btnTest">Test</button>
        <button id="btnCopyLink" type="button">Copy Shareable Link</button>
      </div>
    </form>

    <div id="statusMsg" class="status" style="display:none" role="alert" aria-live="polite"></div>

    <div class="iframe-container" id="iframeContainer" style="display:none" aria-label="Test iframe container">
      <iframe id="targetFrame" sandbox="" title="Target page iframe"></iframe>
      <div class="overlay" id="overlay">
        <div class="lure" id="lure" tabindex="0" role="button" aria-grabbed="false" aria-label="Draggable overlay for clickjacking simulation">
          Clickable Area
        </div>
      </div>
    </div>

    <div class="row" id="controlsRow" style="display:none" aria-label="Controls for iframe and overlay">
      <button id="btnToggleOverlay">Toggle Overlay</button>
      <button id="btnGhostFrame">Make iframe Transparent</button>
      <button id="btnReset">Reset Overlay</button>
      <button id="btnShowPoC">Generate PoC</button>
    </div>

    <section id="resultPanel" class="panel" style="display:none" aria-live="polite">
      <div class="desc-head" id="resultHeader"></div>
      <div class="result-description" id="resultDescription"></div>
      <div class="result-impact" id="resultImpact"></div>
      <div class="result-remediation" id="resultRemediation"></div>
    </section>

    <section id="pocPanel" class="panel" style="display:none">
      <label for="pocCode"><strong>Standalone PoC HTML</strong></label>
      <textarea id="pocCode" readonly rows="8" aria-readonly="true"></textarea>
      <button id="btnCopyPoC" type="button">Copy PoC Code</button>
    </section>
  </div>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const targetUrl = $('targetUrl');
  const btnTest = $('btnTest');
  const btnCopyLink = $('btnCopyLink');
  const statusMsg = $('statusMsg');
  const iframeContainer = $('iframeContainer');
  const targetFrame = $('targetFrame');
  const overlay = $('overlay');
  const lure = $('lure');
  const controlsRow = $('controlsRow');
  const btnToggleOverlay = $('btnToggleOverlay');
  const btnGhostFrame = $('btnGhostFrame');
  const btnReset = $('btnReset');
  const btnShowPoC = $('btnShowPoC');
  const resultPanel = $('resultPanel');
  const resultHeader = $('resultHeader');
  const resultDescription = $('resultDescription');
  const resultImpact = $('resultImpact');
  const resultRemediation = $('resultRemediation');
  const pocPanel = $('pocPanel');
  const pocCode = $('pocCode');
  const btnCopyPoC = $('btnCopyPoC');

  let isVulnerable = false;
  let headerInfo = {};

  function escapeHTML(str) {
    return str.replace(/[&<>"'`]/g, s => ({
      '&': "&amp;",
      '<': "&lt;",
      '>': "&gt;",
      '\"': "&quot;",
      '\'': "&#39;",
      '`': "&#96;"
    }[s]));
  }

  function setStatus(msg, good = false) {
    statusMsg.textContent = msg;
    statusMsg.className = "status " + (good ? "ok" : "bad");
    statusMsg.style.display = "block";
  }

  async function fetchHeaders(url) {
    try {
      let response = await fetch(url, {method: 'HEAD', mode: 'cors'});
      if (!response.ok) return {};
      let headers = {};
      response.headers.forEach((v, k) => headers[k.toLowerCase()] = v);
      return headers;
    } catch(e) {
      return {};
    }
  }

  function updateResult(vulnerable, xfo, csp) {
    if (vulnerable) {
      resultHeader.textContent = "Vulnerable to Clickjacking";
      resultDescription.textContent = "The tested page can be framed by external sites, enabling UI redressing attacks.";
      resultImpact.textContent = "Impact: Malicious overlays could trick users into unintended actions.";
      resultRemediation.innerHTML = "Remediation: Implement HTTP headers:<br/><b>X-Frame-Options</b> (DENY or SAMEORIGIN) or <b>Content-Security-Policy</b> with <code>frame-ancestors 'none'</code>.";
    } else {
      resultHeader.textContent = "No Clickjacking Vulnerability Detected";
      resultDescription.textContent = "The tested page is protected against framing attacks.";
      resultImpact.textContent = "Impact: Clickjacking risk is mitigated for this page.";
      resultRemediation.textContent = "Remediation: Maintain current frame protection headers.";
    }

    // Append header information if available
    let headersInfo = '';
    if (xfo) headersInfo += `X-Frame-Options: ${escapeHTML(xfo)} `;
    if (csp) headersInfo += `Content-Security-Policy: ${escapeHTML(csp)}`;
    if (headersInfo) {
      resultRemediation.innerHTML += `<br/><small style="color:#ccc;">Headers observed: ${headersInfo.trim()}</small>`;
    }

    resultPanel.style.display = "block";
  }

  async function testClickjacking(url) {
    isVulnerable = false;
    headerInfo = await fetchHeaders(url);

    targetFrame.removeAttribute('sandbox');
    targetFrame.src = url;
    iframeContainer.style.display = "block";

    const loadResult = await new Promise(resolve => {
      let timeout = setTimeout(() => resolve(false), 4000);
      targetFrame.onload = () => {
        clearTimeout(timeout);
        resolve(true);
      };
      targetFrame.onerror = () => {
        clearTimeout(timeout);
        resolve(false);
      };
    });

    if (loadResult &&
        (!headerInfo['x-frame-options'] || !/deny|sameorigin/i.test(headerInfo['x-frame-options'])) &&
        (!headerInfo['content-security-policy'] || !/frame-ancestors\s+['"]?none['"]?/i.test(headerInfo['content-security-policy']))) {

      isVulnerable = true;
      setStatus("❗ Target frame loaded — possible vulnerability.", true);
      controlsRow.style.display = "flex";
      overlay.style.display = "block";
    } else {
      setStatus("✅ Framing blocked — no vulnerability detected.", false);
      controlsRow.style.display = "none";
      overlay.style.display = "none";
    }

    updateResult(isVulnerable, headerInfo['x-frame-options'], headerInfo['content-security-policy']);
  }

  // Drag the overlay
  function initDrag() {
    let dragging = false, offsetX = 0, offsetY = 0;

    lure.addEventListener("mousedown", e => {
      dragging = true;
      offsetX = e.clientX - lure.offsetLeft;
      offsetY = e.clientY - lure.offsetTop;
      lure.style.cursor = "grabbing";
      e.preventDefault();
    });
    window.addEventListener("mouseup", () => {
      dragging = false;
      lure.style.cursor = "grab";
    });
    window.addEventListener("mousemove", e => {
      if (dragging) {
        let x = e.clientX - offsetX;
        let y = e.clientY - offsetY;
        // constrain within iframe container
        const rect = iframeContainer.getBoundingClientRect();
        const lureRect = lure.getBoundingClientRect();
        x = Math.min(Math.max(0, x), rect.width - lureRect.width);
        y = Math.min(Math.max(0, y), rect.height - lureRect.height);
        lure.style.left = x + "px";
        lure.style.top = y + "px";
      }
    });

    // Keyboard accessibility for overlay positioning
    lure.addEventListener("keydown", e => {
      const step = 10;
      const left = parseInt(lure.style.left || 0);
      const top = parseInt(lure.style.top || 0);
      if(e.key === "ArrowLeft") {
        lure.style.left = Math.max(0, left - step) + "px";
        e.preventDefault();
      } else if(e.key === "ArrowRight") {
        lure.style.left = left + step + "px";
        e.preventDefault();
      } else if(e.key === "ArrowUp") {
        lure.style.top = Math.max(0, top - step) + "px";
        e.preventDefault();
      } else if(e.key === "ArrowDown") {
        lure.style.top = top + step + "px";
        e.preventDefault();
      }
    });
  }

  // Toggle overlay visibility
  btnToggleOverlay.addEventListener("click", () => {
    overlay.style.display = (overlay.style.display === "none" ? "block" : "none");
  });
  // Apply ghost (transparent) mode to iframe
  btnGhostFrame.addEventListener("click", () => {
    targetFrame.classList.add("ghost");
  });
  // Reset overlay position and remove ghost mode
  btnReset.addEventListener("click", () => {
    targetFrame.classList.remove("ghost");
    lure.style.left = "18%";
    lure.style.top = "20%";
  });
  // Generate standalone PoC code block
  btnShowPoC.addEventListener("click", () => {
    if (!targetUrl.value) {
      setStatus("Enter a valid URL before generating PoC.", false);
      return;
    }
    const pocHTML = `
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Clickjacking PoC</title>
<style>
  body { margin:0; background:#192a42; display:flex; justify-content:center; align-items:center; height:100vh; font-family:sans-serif; }
  .wrapper { position:relative; width:480px; height:320px; border-radius:16px; overflow:hidden; box-shadow:0 0 40px #154a8c; }
  iframe { width:100%; height:100%; border:none; border-radius:16px; }
  .overlay {
    position:absolute; top:0; left:0; right:0; bottom:0;
    background:#54a6ff44;
  }
</style>
</head>
<body>
  <div class="wrapper">
    <iframe src="${escapeHTML(targetUrl.value)}" sandbox></iframe>
    <div class="overlay"></div>
  </div>
</body>
</html>`;
    pocCode.value = pocHTML.trim();
    pocPanel.style.display = "block";
    pocCode.select();
  });
  // Copy PoC code to clipboard
  btnCopyPoC.addEventListener("click", async () => {
    try {
      await navigator.clipboard.writeText(pocCode.value);
      setStatus("PoC code copied to clipboard", true);
    } catch {
      setStatus("Failed to copy PoC code", false);
    }
  });

  // Shareable link for testing
  btnCopyLink.addEventListener("click", async () => {
    if (!targetUrl.value) {
      setStatus("Enter a valid URL before copying link", false);
      return;
    }
    const link = window.location.origin + window.location.pathname + "?url=" + encodeURIComponent(targetUrl.value);
    try {
      await navigator.clipboard.writeText(link);
      setStatus("Shareable link copied to clipboard", true);
    } catch {
      setStatus("Failed to copy shareable link", false);
    }
  });

  // Test button functionality
  btnTest.addEventListener("click", () => {
    try {
      const url = new URL(targetUrl.value);
      testClickjacking(url.href);
    } catch {
      setStatus("Invalid URL. Please enter a valid https:// URL.", false);
    }
  });

  // Auto-fill URL from query string and trigger test if present
  const initUrl = new URLSearchParams(window.location.search).get("url");
  if (initUrl) {
    targetUrl.value = initUrl;
    btnTest.click();
  }

  // Initialize drag functionality
  initDrag();

  // Initialize overlay hidden
  overlay.style.display = "none";

  // Reset overlay initial position
  lure.style.left = "18%";
  lure.style.top = "20%";

})();
</script>
</body>
</html>
